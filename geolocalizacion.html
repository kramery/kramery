<!DOCTYPE html>
<html lang="es">
<head>
	<title>HTML5 Geolocalizacion</title>
	<meta charset="utf-8">
</head>
<body>
	<div id="mapa">
		--AQUI VA NUESTRO MAPA--
	</div>
	<script type="text/javascript">
/*EJERCICIO 1. MOSTRAR UBICACIÓN DEL USUARIO*/

		if (navigator.geolocation) {  /*Comprueba si el Navegador soporta la propiedad geolocation del objeto navigator. Si lo hace nos vamos a la línea siguiente*/ 
           navigator.geolocation.getCurrentPosition(fn_ok, fn_error); /*getCurrentPosition nos da la ubicación del usuario. Si el usuario acepta compartir la ubicación se disparará la función fn_ok, si no se disparará fn_error*/
        } else {  alert('Geolocation is not supported in this page.'); } /*Si la geolocalización no funciona saltará este mensaje*/
	
	var divMapa= document.getElementById("mapa"); /*Creamos una variable llamada divMapa, que básicamente va a acceder al elemento con la id mapa*/

	function fn_error(){ /*Si el usuario no ha compartido la ubicación se dispara esta función*/
		divMapa.innerHTML = "Hubo problema solicitando los datos"; /*Intenta acceder a divMapa, pero como no puede le lanza un mensaje HTML diciendo que hubo un problema.*/
	}
	function fn_ok(respuesta){/*Si el usuario ha compartido la ubicación se dispara esta función. Le pasamos el parámetro respuesta*/
		var lat = respuesta.coords.latitude; /*Declaramos una variable llamada lat y accedemos al objeto coords del parámetro respuesta, que es donde están las coordenadas, la latitud y la longitud. En este caso pedimos la latitud y en la línea de abajo hacemos lo mismo con la longitud*/
		var lon = respuesta.coords.longitude;
		divMapa.innerHTML=lat + " , " + lon; /*Al acceder a divMapa le pedimos que lance un mensaje HTML mostrando los valores anteriores. */
	}

	function mostrar_objeto(obj){ /*Vamos a utilizar el objeto nativo de JavaScript Navigator. Le decimos que va a recibir un objeto*/
		for (var prop in obj){ /*Con este bucle va a recorrer todas las propiedades del objeto*/
			document.write( prop+ ": " + obj[prop] + "<br/>"); /*Y las va a mostrar en pantalla*/
		}
	}
	</script>


	<script type="text/javascript">
/*EJERCICIO 2. MOSTRAR UBICACIÓN DEL USUARIO Y AÑADIR NUEVA UBICACIÓN - MAPA ESTÁTICO*/

	if (navigator.geolocation) {  /*Comprueba si el Navegador soporta la propiedad geolocation del objeto navigator. Si lo hace nos vamos a la línea siguiente*/  
           navigator.geolocation.getCurrentPosition(fn_ok, fn_error); /*getCurrentPosition nos da la ubicación del usuario. Si el usuario acepta compartir la ubicación se disparará la función fn_ok, si no se disparará fn_error*/
        } else {  alert('Geolocation is not supported in this page.')}; /*Si la geolocalización no funciona saltará este mensaje*/
        
        var divMapa = document.getElementById("mapa"); /*Creamos una variable llamada divMapa, que básicamente va a acceder al elemento con la id mapa*/
        
        function fn_error(){  /*Si el usuario no ha compartido la ubicación se dispara esta función*/
			divMapa.innerHTML = "Hubo problema solicitando los datos"; /*Intenta acceder a divMapa, pero como no puede le lanza un mensaje HTML diciendo que hubo un problema.*/
		}
		
		function fn_ok(respuesta){ /*Si el usuario ha compartido la ubicación se dispara esta función. Le pasamos el parámetro respuesta*/
			var lat = respuesta.coords.latitude; /*Declaramos una variable llamada lat y accedemos al objeto coords del parámetro respuesta, que es donde están las coordenadas, la latitud y la longitud. En este caso pedimos la latitud y en la línea de abajo hacemos lo mismo con la longitud*/
			var lon = respuesta.coords.longitude;
			var coordenada = lat+ "," + lon;/*Declaramos una variable llamada coordenada y le pedimos que almacene los valores de la latitud y la longitud */

			//por GET --> URL parametro toda la informacion del mapa
			//ruta?var=valor&otra_variable=valor
			//Ruta para solicitar a Google el mapa estatico
			divMapa.innerHTML = '<img src="http://maps.googleapis.com/maps/api/staticmap?size=700x400&markers='+coordenada+' &markers=color:blue|label:E|cartuja,Sevilla" />'; /*Al acceder a divMapa va a mostrar un HTML con la foto que se toma de la API de Google con las coordenadas anteriores. En size encontramos el tamaño de la imagen & el marcador. Despues de "coordenada" le decimos que puede mostrar otra dirección con un marcador azul, ponemos un indicador también con LA Cartuja, Sevilla por ejemplo.*/
			}
			
	</script>

	<script type="text/javascript">
/*EJERCICIO 3. MOSTRAR UBICACIÓN DEL USUARIO - MAPA DINÁMICO*/

/*Antes que nada necesitamos incorporar la librería de Google Maps en el head, e indicar el tamaño del mapa en el CSS 
<script src="http://maps.google.com/maps/api/js?sensor=false"> y cerramos etiqueta*/


 	var divMapa = document.getElementById("mapa"); /*Creamos una variable llamada divMapa, que básicamente va a acceder al elemento con la id mapa*/

 	if (navigator.geolocation) { /*Comprueba si el Navegador soporta la propiedad geolocation del objeto navigator. Si lo hace nos vamos a la línea siguiente*/ 
           navigator.geolocation.getCurrentPosition(fn_ok, fn_error); /*getCurrentPosition nos da la ubicación del usuario. Si el usuario acepta compartir la ubicación se disparará la función fn_ok, si no se disparará fn_error*/
        } else {  alert('Geolocation is not supported in this page.')}; /*Si la geolocalización no funciona saltará este mensaje*/

        function fn_error(){ /*Si el usuario no ha compartido la ubicación se dispara esta función. Como no nos interesa podemos dejarla en blanco*/
		} 

		function fn_ok(respuesta){ /*Si el usuario ha compartido la ubicación se dispara esta función. Le pasamos el parámetro respuesta*/
			var lat = respuesta.coords.latitude; /*Declaramos una variable llamada lat y accedemos al objeto coords del parámetro respuesta, que es donde están las coordenadas, la latitud y la longitud. En este caso pedimos la latitud y en la línea de abajo hacemos lo mismo con la longitud*/
			var lon = respuesta.coords.longitude;

			var gLatLon= new google.maps.LatLng(lat, lon); /*Declaramos una variable y convertimos la información anterior a un objeto de Google*/

			var objConfig = { /*Declaramos una variable que va a contener la configuración del mapa con el zoom (mientras mayor sea más cerca estará) y que se centre en base a la latitud y longitud que tenemos.*/
				zoom: 17,
				center: gLatLon,
			}

			var gMapa = new google.maps.Map(divMapa, objConfig); /*Creamos el mapa como un nuevo objeto de Google y le pasamos 2 parámetros. El primero es donde se va a mostrar el mapa (como declaramos al principio va a acceder al elemento con id mapa) y el segundo es la configuración del mapa que hemos declarado antes.*/


			//Creamos el indicador
			//requiere dos objetos: Configuracion, y en que mapa //Objetos de google
			var objConfigMarker={ /*Declaramos una variable que va a contener la configuración del marcador del mapa con la posición (que será la latitud y la longitud), en el mapa donde se tiene que mostrar y un título con un mensaje de "Se encuentra aquí"*/    
				position: gLatLon,
				map: gMapa,
				title: "Se encuentra Aqui!!!!"
			}
			var gMarker = new google.maps.Marker(objConfigMarker); /*Creamos el marcador como un nuevo objeto de Google y le pasamos 1 parámetro con la configuración del marcador que hemos declarado antes.*/
		}
	</script>



	<script type="text/javascript">
/*EJERCICIO 4. MOSTRAR DIRECCIÓN EXACTA PARA MOSTRAR UBICACIÓN EN EL MAPA Y UBICACIÓN DEL USUARIO - MAPA DINÁMICO*/

/*Antes que nada necesitamos incorporar la librería de Google Maps en el head, e indicar el tamaño del mapa en el CSS 
<script src="http://maps.google.com/maps/api/js?sensor=false"> y cerramos etiqueta*/


 	var divMapa = document.getElementById("mapa"); /*Creamos una variable llamada divMapa, que básicamente va a acceder al elemento con la id mapa*/

 	if (navigator.geolocation) { /*Comprueba si el Navegador soporta la propiedad geolocation del objeto navigator. Si lo hace nos vamos a la línea siguiente*/ 
           navigator.geolocation.getCurrentPosition(fn_ok, fn_error); /*getCurrentPosition nos da la ubicación del usuario. Si el usuario acepta compartir la ubicación se disparará la función fn_ok, si no se disparará fn_error*/
        } else {  alert('Geolocation is not supported in this page.')}; /*Si la geolocalización no funciona saltará este mensaje*/

        function fn_error(){ /*Si el usuario no ha compartido la ubicación se dispara esta función. Como no nos interesa podemos dejarla en blanco*/
		} 

		function fn_ok(respuesta){ /*Si el usuario ha compartido la ubicación se dispara esta función. Le pasamos el parámetro respuesta*/
			var lat = respuesta.coords.latitude; /*Declaramos una variable llamada lat y accedemos al objeto coords del parámetro respuesta, que es donde están las coordenadas, la latitud y la longitud. En este caso pedimos la latitud y en la línea de abajo hacemos lo mismo con la longitud*/
			var lon = respuesta.coords.longitude;

			var gLatLon= new google.maps.LatLng(lat, lon); /*Declaramos una variable y convertimos la información anterior a un objeto de Google*/

			var objConfig = { /*Declaramos una variable que va a contener la configuración del mapa con el zoom (mientras mayor sea más cerca estará) y que se centre en base a la latitud y longitud que tenemos.*/
				zoom: 17,
				center: gLatLon,
			}

			var gMapa = new google.maps.Map(divMapa, objConfig); /*Creamos el mapa como un nuevo objeto de Google y le pasamos 2 parámetros. El primero es donde se va a mostrar el mapa (como declaramos al principio va a acceder al elemento con id mapa) y el segundo es la configuración del mapa que hemos declarado antes.*/


			var objConfigMarker={ /*Declaramos una variable que va a contener la configuración del marcador del mapa con la posición (que será la latitud y la longitud), en el mapa donde se tiene que mostrar. Con animation DROP indica que el marcador aparecerá desde lo alto del mapa y caerá hasta la posición. Con la propiedad draggable podemos mover nuestros marcadores por el mapa y con el título con un mensaje de "Se encuentra aquí"*/    
				position: gLatLon,
				animation: google.maps.Animation.DROP,
				map: gMapa,
				draggable: true,
				title: "Se encuentra Aqui!!!!"
			}
			var gMarker = new google.maps.Marker(objConfigMarker); /*Creamos el marcador como un nuevo objeto de Google y le pasamos 1 parámetro con la configuración del marcador que hemos declarado antes.*/
			gMarker.setIcon("Squirtle.jpg") /*Le pedimos que el marcador envie un icono, que será una imagen (deberemos poner la URL de la imagen)*/

			
			var gCoder = new google.maps.Geocoder(); /*Creamos el objeto gCoder como un nuevo objeto de Google de tipo Geocoder, que traduce una dirección en una coordenada*/
			var objInformacion = { /*Creamos una variable con la información de la dirección que queremos que señale*/
				address: "Cartuja, Sevilla",
			}
			gCoder.geocode(objInformacion, fn_coder); /*Creamos una función utilizando el objeto gCoder con la propiedad geocode y le pasamos 2 parámetros. El primero es el objeto con la información de la dirección y el segundo es la función que se va a ejecutar si todo está OK*/
			
			function fn_coder(datos){ /*Esta es la función que se inicializará si todo es´tá correcto. Le pasamos el parámetro datos, que es intrínseco de JavaScript*/
				var coordenadas= datos[0].geometry.location; /*Declaramos una variable con el parámetro que le hemos pasado a la función y la propiedad geometry que contiene la latitud y la longitud de Google, que vamos a utilizar como marcador*/
				var config ={
					map: gMapa,
					animation: google.maps.Animation.DROP,
					position: coordenadas,
					title: "Isla de la Cartuja"
				}
				var gMarkerDV = new  google.maps.Marker(config); /*Creamos un nuevo marcador como un nuevo objeto de Google y le pasamos 1 parámetro con la configuración del marcador que hemos declarado antes.*/
				gMarkerDV.setIcon("icon_edificio.png"); /*También le pedimos que el marcador envie un icono, que será una imagen (deberemos poner la URL de la imagen)*/


				var objHTML = { /*Creamos un objeto con la información que queremos que aparezca en el marcador. POdemos definir el estilo, el tamaño y el contenido*/
					content: "<div style='heigth: 150px; width: 300px'><h2>Isla de la Carturja</h2><h3>Antigua Expo92</h3><p> Para mas Informacion<a href='http://www.expo92.es'>aqui</a></p></div>"
				}
				var gIW = new google.maps.InfoWindow(objHTML); /*Creamos un nuevo objeto de Google de tipo InfoWindow, para que al hacer clic en el marcador nos muestre información. Le pasamos un parámetro que será la variable declarada antes.*/      

				google.maps.event.addListener(gMarkerDV, "click", function(){ /*Para que el marcador responda a un click del usuario y muestre información es necesario realizar el siguiente evento. Como es un objeto de Google es un poco diferente. Utilizamos una función con el escuchador de evento addListener y le pasamos 3 parámetros. El primero es el marcador, el segundo el evento (en este caso onclick) y la siguiente función.*/
					//abrimos la ventana Modal
					gIW.open(gMapa, gMarkerDV); /*LE pedimos que nos abra el objeto que lleva la información con 2 parámetros. El primero es el mapa donde queremos que aparezca y el segundo el marcador*/
				});
			}
		}
	</script>


	<script type="text/javascript">
/*EJERCICIO 5. MOSTRAR LA RUTA DE MI UBICACIÓN HASTA EL DESTINO - MAPA DINÁMICO*/

/*Antes que nada necesitamos incorporar la librería de Google Maps en el head, e indicar el tamaño del mapa en el CSS 
<script src="http://maps.google.com/maps/api/js?sensor=false"> y cerramos etiqueta*/

 	var divMapa = document.getElementById("mapa"); /*Creamos una variable llamada divMapa, que básicamente va a acceder al elemento con la id mapa*/

 	if (navigator.geolocation) { /*Comprueba si el Navegador soporta la propiedad geolocation del objeto navigator. Si lo hace nos vamos a la línea siguiente*/ 
           navigator.geolocation.getCurrentPosition(fn_ok, fn_error); /*getCurrentPosition nos da la ubicación del usuario. Si el usuario acepta compartir la ubicación se disparará la función fn_ok, si no se disparará fn_error*/
        } else {  alert('Geolocation is not supported in this page.')}; /*Si la geolocalización no funciona saltará este mensaje*/

        function fn_error(){ /*Si el usuario no ha compartido la ubicación se dispara esta función. Como no nos interesa podemos dejarla en blanco*/
		} 

		function fn_ok(respuesta){ /*Si el usuario ha compartido la ubicación se dispara esta función. Le pasamos el parámetro respuesta*/
			var lat = respuesta.coords.latitude; /*Declaramos una variable llamada lat y accedemos al objeto coords del parámetro respuesta, que es donde están las coordenadas, la latitud y la longitud. En este caso pedimos la latitud y en la línea de abajo hacemos lo mismo con la longitud*/
			var lon = respuesta.coords.longitude;

			var gLatLon= new google.maps.LatLng(lat, lon); /*Declaramos una variable y convertimos la información anterior a un objeto de Google*/

			var objConfig = { /*Declaramos una variable que va a contener la configuración del mapa con el zoom (mientras mayor sea más cerca estará) y que se centre en base a la latitud y longitud que tenemos.*/
				zoom: 17,
				center: gLatLon,
			}

			var gMapa = new google.maps.Map(divMapa, objConfig); /*Creamos el mapa como un nuevo objeto de Google y le pasamos 2 parámetros. El primero es donde se va a mostrar el mapa (como declaramos al principio va a acceder al elemento con id mapa) y el segundo es la configuración del mapa que hemos declarado antes.*/


			var objConfigMarker={ /*Declaramos una variable que va a contener la configuración del marcador del mapa con la posición (que será la latitud y la longitud), en el mapa donde se tiene que mostrar. Con animation DROP indica que el marcador aparecerá desde lo alto del mapa y caerá hasta la posición. Con la propiedad draggable podemos mover nuestros marcadores por el mapa y con el título con un mensaje de "Se encuentra aquí"*/    
				position: gLatLon,
				animation: google.maps.Animation.DROP,
				map: gMapa,
				draggable: true,
				title: "Se encuentra Aqui!!!!"
			}
			var gMarker = new google.maps.Marker(objConfigMarker); /*Creamos el marcador como un nuevo objeto de Google y le pasamos 1 parámetro con la configuración del marcador que hemos declarado antes.*/
			gMarker.setIcon("Squirtle.jpg") /*Le pedimos que el marcador envie un icono, que será una imagen (deberemos poner la URL de la imagen)*/

			
			var gCoder = new google.maps.Geocoder(); /*Creamos el objeto gCoder como un nuevo objeto de Google de tipo Geocoder, que traduce una dirección en una coordenada*/
			var objInformacion = { /*Creamos una variable con la información de la dirección que queremos que señale*/
				address: "Cartuja, Sevilla",
			}
			gCoder.geocode(objInformacion, fn_coder); /*Creamos una función utilizando el objeto gCoder con la propiedad geocode y le pasamos 2 parámetros. El primero es el objeto con la información de la dirección y el segundo es la función que se va a ejecutar si todo está OK*/
			
			function fn_coder(datos){ /*Esta es la función que se inicializará si todo es´tá correcto. Le pasamos el parámetro datos, que es intrínseco de JavaScript*/
				var coordenadas= datos[0].geometry.location; /*Declaramos una variable con el parámetro que le hemos pasado a la función y la propiedad geometry que contiene la latitud y la longitud de Google, que vamos a utilizar como marcador*/
				var config ={
					map: gMapa,
					animation: google.maps.Animation.DROP,
					position: coordenadas,
					title: "Isla de la Cartuja"
				}
				var gMarkerDV = new  google.maps.Marker(config); /*Creamos un nuevo marcador como un nuevo objeto de Google y le pasamos 1 parámetro con la configuración del marcador que hemos declarado antes.*/
				gMarkerDV.setIcon("icon_edificio.png"); /*También le pedimos que el marcador envie un icono, que será una imagen (deberemos poner la URL de la imagen)*/


				var objHTML = { /*Creamos un objeto con la información que queremos que aparezca en el marcador. POdemos definir el estilo, el tamaño y el contenido*/
					content: "<div style='heigth: 150px; width: 300px'><h2>Isla de la Carturja</h2><h3>Antigua Expo92</h3><p> Para mas Informacion<a href='http://www.expo92.es'>aqui</a></p></div>"
				}
				var gIW = new google.maps.InfoWindow(objHTML); /*Creamos un nuevo objeto de Google de tipo InfoWindow, para que al hacer clic en el marcador nos muestre información. Le pasamos un parámetro que será la variable declarada antes.*/      

				google.maps.event.addListener(gMarkerDV, "click", function(){ /*Para que el marcador responda a un click del usuario y muestre información es necesario realizar el siguiente evento. Como es un objeto de Google es un poco diferente. Utilizamos una función con el escuchador de evento addListener y le pasamos 3 parámetros. El primero es el marcador, el segundo el evento (en este caso onclick) y la siguiente función.*/
					//abrimos la ventana Modal
					gIW.open(gMapa, gMarkerDV); /*LE pedimos que nos abra el objeto que lleva la información con 2 parámetros. El primero es el mapa donde queremos que aparezca y el segundo el marcador*/
				});
			}




			var ds = new google.maps.DirectionsService(); /*Creamos el objeto de Google ds, que obtendrá las coordenadas mediante la propiedad DirectionService (implícita de Google)*/
			var dr = new google.maps.DirectionsRenderer(objConfigDR); /*Creamos el objeto de Google dr, que traducirá las coordenadas a una ruta entre 2 puntos mediante la propiedad DirectionRenderer(implícita de Google). Le pasamos un parámetro que será el objeto que definimos anteriormente con la configuración*/

			var objConfigDR ={ /*Definimos un objeto que tendrá la configuración de la ruta */
				map: gMapa, /*Utilizamos el parámetro map y le decimos el mapa sobre el que vamos a trazar la línea*/
				suppressMarkers: true /*Con ello eliminamos los marcadores (el pincho rojo y azul que viene por defecto) y que aparezcan los que hemos creado (las imágenes que pusimos anteriormente)*/
			}

			//Medios : DRIVING, BYCICLING, WALKING, TRANSIT
			var objConfigDs = { /*Creamos el objeto que va a tener la configuración de las coordenadas. Utilizamos los 3 siguientes parámetros:*/
				origin: gLatLon, /*El punto de origen y le decimos que coja el objeto que tenía la latitud y la longitud de la primera posición. También podemos decirle una latitud y una longitud separados por coma. */
				destination: objInformacion.address, /*El punto de destino y le decimos que coja el objeto que tenía la latitud y la longitud de la segunda posición. NOs interesa la propiedad de la dirección que pusimos en ese objeto así que se la pedimos. */
				travelMode: google.maps.TravelMode.WALKING /*Indica el medio de transporte por el que llegamos del origen al destino. Puede ser DRIVING, BICYCLING, TRANSIT o WALKING*/ 
			}

			
			ds.route(objConfigDs, fn_rutear); /*EL objeto DirectionsService tiene una función llamada route, que le pasamos 2 parámetros. El primero es el objeto con la configuración de la ruta y el segundo es la función que calcula los datos que necesita y se los pasa a Renderer para que los muestre.*/

			function fn_rutear(resultados, status){ /*Creamos la función fn_rutear con 2 parámetros (que no hemos creado, son implícitos).*/
				//Mostrar la linea entre origen y detino
				if ( status == "OK"){ /*Si todo está OK mandará la información de la dirección con el resultado*/
					dr.setDirections(resultados);
				}else{ /*Si no enviará un mensaje de error*/
					alert ("Error" + status);
				}
			}

		}

	</script>



</body>
</html>